<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PersonalFinanceClient.MainPage"
             Title="Главная">

    <RefreshView IsRefreshing="{Binding IsLoading}" 
                 Command="{Binding LoadDataCommand}">

        <ScrollView>
            <VerticalStackLayout Spacing="15" Padding="20">

                <!-- Заголовок -->
                <HorizontalStackLayout>
                    <VerticalStackLayout>
                        <Label Text="Добро пожаловать," 
                               FontSize="16" 
                               TextColor="Gray"/>
                        <Label Text="{Binding UserProfile.Username}" 
                               FontSize="20" 
                               FontAttributes="Bold"/>
                    </VerticalStackLayout>

                    <Button Text="Выйти" 
                            Command="{Binding LogoutCommand}"
                            HorizontalOptions="EndAndExpand"
                            BackgroundColor="Transparent"
                            TextColor="Gray"/>
                </HorizontalStackLayout>

                <!-- Общий баланс -->
                <Frame Padding="20" 
                       BackgroundColor="#2196F3" 
                       CornerRadius="15">
                    <VerticalStackLayout>
                        <Label Text="Общий баланс" 
                               FontSize="16" 
                               TextColor="White"/>
                        <Label Text="{Binding TotalBalance, StringFormat='{0:C}'}" 
                               FontSize="32" 
                               FontAttributes="Bold" 
                               TextColor="White"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Быстрые действия -->
                <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="10">
                    <Button Text="➕" 
                            Command="{Binding GoToAddTransactionCommand}"
                            CornerRadius="10"
                            BackgroundColor="#4CAF50"
                            TextColor="White"/>
                    <Button Text="💳" 
                            Command="{Binding GoToAccountsCommand}"
                            CornerRadius="10"
                            BackgroundColor="#FF9800"
                            TextColor="White"/>
                    <Button Text="📊" 
                            Command="{Binding GoToTransactionsCommand}"
                            CornerRadius="10"
                            BackgroundColor="#9C27B0"
                            TextColor="White"/>
                    <Button Text="⚙️" 
                            Command="{Binding GoToAccountsCommand}"
                            CornerRadius="10"
                            BackgroundColor="#607D8B"
                            TextColor="White"/>
                </Grid>

                <!-- Мои счета -->
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout>
                        <Label Text="Мои счета" 
                               FontSize="18" 
                               FontAttributes="Bold"/>
                        <Label Text=" Все" 
                               FontSize="14" 
                               TextColor="#2196F3"
                               HorizontalOptions="EndAndExpand">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding GoToAccountsCommand}"/>
                            </Label.GestureRecognizers>
                        </Label>
                    </HorizontalStackLayout>

                    <CollectionView ItemsSource="{Binding Accounts}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Padding="15" 
                                       CornerRadius="10" 
                                       BackgroundColor="#F5F5F5">
                                    <HorizontalStackLayout>
                                        <VerticalStackLayout>
                                            <Label Text="{Binding Name}" 
                                                   FontSize="16" 
                                                   FontAttributes="Bold"/>
                                            <Label Text="{Binding Type}" 
                                                   FontSize="12" 
                                                   TextColor="Gray"/>
                                        </VerticalStackLayout>
                                        <Label Text="{Binding Balance, StringFormat='{0:C}'}" 
                                               FontSize="16" 
                                               FontAttributes="Bold"
                                               HorizontalOptions="EndAndExpand"/>
                                    </HorizontalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>

                <!-- Последние транзакции -->
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout>
                        <Label Text="Последние транзакции" 
                               FontSize="18" 
                               FontAttributes="Bold"/>
                        <Label Text=" Все" 
                               FontSize="14" 
                               TextColor="#2196F3"
                               HorizontalOptions="EndAndExpand">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding GoToTransactionsCommand}"/>
                            </Label.GestureRecognizers>
                        </Label>
                    </HorizontalStackLayout>

                    <CollectionView ItemsSource="{Binding RecentTransactions}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Padding="10" 
                                       CornerRadius="10" 
                                       BackgroundColor="#FFFFFF"
                                       BorderColor="#E0E0E0">
                                    <HorizontalStackLayout>
                                        <BoxView Color="{Binding CategoryColor}" 
                                                 WidthRequest="5" 
                                                 HeightRequest="40"/>
                                        <VerticalStackLayout Margin="10,0,0,0">
                                            <Label Text="{Binding Description}" 
                                                   FontSize="14"/>
                                            <Label Text="{Binding CategoryName}" 
                                                   FontSize="12" 
                                                   TextColor="Gray"/>
                                        </VerticalStackLayout>
                                        <Label Text="{Binding Amount, StringFormat='{0:C}'}" 
                                               FontSize="14" 
                                               FontAttributes="Bold"
                                               HorizontalOptions="EndAndExpand"
                                               TextColor="{Binding Type, Converter={StaticResource TransactionTypeToColorConverter}}"/>
                                    </HorizontalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </ScrollView>

    </RefreshView>
</ContentPage>